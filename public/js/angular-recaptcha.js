(function(ng){'use strict';ng.module('vcRecaptcha',[]);}(angular));(function(ng){'use strict';function throwNoKeyException(){throw new Error('You need to set the "key" attribute to your public reCaptcha key. If you don\'t have a key, please get one from https://www.google.com/recaptcha/admin/create');}
var app=ng.module('vcRecaptcha');app.provider('vcRecaptchaService',function(){var provider=this;var config={};provider.onLoadFunctionName='vcRecaptchaApiLoaded';provider.setDefaults=function(defaults){ng.copy(defaults,config);};provider.setSiteKey=function(siteKey){config.key=siteKey;};provider.setTheme=function(theme){config.theme=theme;};provider.setStoken=function(stoken){config.stoken=stoken;};provider.setSize=function(size){config.size=size;};provider.setType=function(type){config.type=type;};provider.setLang=function(lang){config.lang=lang;};provider.setBadge=function(badge){config.badge=badge;};provider.setOnLoadFunctionName=function(onLoadFunctionName){provider.onLoadFunctionName=onLoadFunctionName;};provider.$get=['$rootScope','$window','$q','$document','$interval',function($rootScope,$window,$q,$document,$interval){var deferred=$q.defer(),promise=deferred.promise,instances={},recaptcha;$window.vcRecaptchaApiLoadedCallback=$window.vcRecaptchaApiLoadedCallback||[];var callback=function(){recaptcha=$window.grecaptcha;deferred.resolve(recaptcha);};$window.vcRecaptchaApiLoadedCallback.push(callback);$window[provider.onLoadFunctionName]=function(){$window.vcRecaptchaApiLoadedCallback.forEach(function(callback){callback();});};function getRecaptcha(){if(!!recaptcha){return $q.when(recaptcha);}
return promise;}
function validateRecaptchaInstance(){if(!recaptcha){throw new Error('reCaptcha has not been loaded yet.');}}
function isRenderFunctionAvailable(){return ng.isFunction(($window.grecaptcha||{}).render);}
if(isRenderFunctionAvailable()){callback();}else if($window.document.querySelector('script[src^="https://www.google.com/recaptcha/api.js"]')){var intervalWait=$interval(function(){if(isRenderFunctionAvailable()){$interval.cancel(intervalWait);callback();}},25);}else{var script=$window.document.createElement('script');script.async=true;script.defer=true;script.src='https://www.google.com/recaptcha/api.js?onload='+provider.onLoadFunctionName+'&render=explicit';$document.find('body')[0].appendChild(script);}
return{create:function(elm,conf){conf.sitekey=conf.key||config.key;conf.theme=conf.theme||config.theme;conf.stoken=conf.stoken||config.stoken;conf.size=conf.size||config.size;conf.type=conf.type||config.type;conf.hl=conf.lang||config.lang;conf.badge=conf.badge||config.badge;if(!conf.sitekey){throwNoKeyException();}
return getRecaptcha().then(function(recaptcha){var widgetId=recaptcha.render(elm,conf);instances[widgetId]=elm;return widgetId;});},reload:function(widgetId){validateRecaptchaInstance();recaptcha.reset(widgetId);$rootScope.$broadcast('reCaptchaReset',widgetId);},execute:function(widgetId){validateRecaptchaInstance();recaptcha.execute(widgetId);},useLang:function(widgetId,lang){var instance=instances[widgetId];if(instance){var iframe=instance.querySelector('iframe');if(lang){if(iframe&&iframe.src){var s=iframe.src;if(/[?&]hl=/.test(s)){s=s.replace(/([?&]hl=)\w+/,'$1'+lang);}else{s+=((s.indexOf('?')===-1)?'?':'&')+'hl='+lang;}
iframe.src=s;}}else{if(iframe&&iframe.src&&/[?&]hl=\w+/.test(iframe.src)){return iframe.src.replace(/.+[?&]hl=(\w+)([^\w].+)?/,'$1');}else{return null;}}}else{throw new Error('reCaptcha Widget ID not exists',widgetId);}},getResponse:function(widgetId){validateRecaptchaInstance();return recaptcha.getResponse(widgetId);},getInstance:function(widgetId){return instances[widgetId];},destroy:function(widgetId){delete instances[widgetId];}};}];});}(angular));(function(ng){'use strict';var app=ng.module('vcRecaptcha');app.directive('vcRecaptcha',['$document','$timeout','vcRecaptchaService',function($document,$timeout,vcRecaptcha){return{restrict:'A',require:"?^^form",scope:{response:'=?ngModel',key:'=?',stoken:'=?',theme:'=?',size:'=?',type:'=?',lang:'=?',badge:'=?',tabindex:'=?',required:'=?',onCreate:'&',onSuccess:'&',onExpire:'&',onError:'&'},link:function(scope,elm,attrs,ctrl){scope.widgetId=null;if(ctrl&&ng.isDefined(attrs.required)){scope.$watch('required',validate);}
var removeCreationListener=scope.$watch('key',function(key){var callback=function(gRecaptchaResponse){$timeout(function(){scope.response=gRecaptchaResponse;validate();scope.onSuccess({response:gRecaptchaResponse,widgetId:scope.widgetId});});};vcRecaptcha.create(elm[0],{callback:callback,key:key,stoken:scope.stoken||attrs.stoken||null,theme:scope.theme||attrs.theme||null,type:scope.type||attrs.type||null,lang:scope.lang||attrs.lang||null,tabindex:scope.tabindex||attrs.tabindex||null,size:scope.size||attrs.size||null,badge:scope.badge||attrs.badge||null,'expired-callback':expired,'error-callback':attrs.onError?error:undefined}).then(function(widgetId){validate();scope.widgetId=widgetId;scope.onCreate({widgetId:widgetId});scope.$on('$destroy',destroy);scope.$on('reCaptchaReset',function(event,resetWidgetId){if(ng.isUndefined(resetWidgetId)||widgetId===resetWidgetId){scope.response="";validate();}})});removeCreationListener();});function destroy(){if(ctrl){ctrl.$setValidity('recaptcha',null);}
cleanup();}
function expired(){$timeout(function(){scope.response="";validate();scope.onExpire({widgetId:scope.widgetId});});}
function error(){var args=arguments;$timeout(function(){scope.response="";validate();scope.onError({widgetId:scope.widgetId,arguments:args});});}
function validate(){if(ctrl){ctrl.$setValidity('recaptcha',scope.required===false?null:Boolean(scope.response));}}
function cleanup(){vcRecaptcha.destroy(scope.widgetId);ng.element($document[0].querySelectorAll('.pls-container')).parent().remove();}}};}]);}(angular));